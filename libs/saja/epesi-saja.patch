Only in saja: epesi-saja.patch
Only in saja: licence.txt
Only in saja: readme.txt
diff -rup saja-2.8/saja.js saja/saja.js
--- saja-2.8/saja.js	2007-07-16 20:58:00.000000000 +0200
+++ saja/saja.js	2007-07-24 17:39:25.000000000 +0200
@@ -1,12 +1,15 @@
 var saja = {
 	procOn:0,
-	history:[],
-	historyIndex:0,
+	indicator:'sajaStatus',
 	updateIndicator: function(){
-		var s = document.getElementById('sajaStatus');
+		var s = document.getElementById(saja.indicator);
 		if(s)
 			s.style.visibility = saja.procOn ? 'visible' : 'hidden';
 	},
+	updateIndicatorText: function(text){
+		var s = document.getElementById(saja.indicator);
+		s.innerHTML = text;
+	},
 	getReq: function(){
 		if(window.XMLHttpRequest)
 			try{return new XMLHttpRequest();}catch(e){}
@@ -14,16 +17,10 @@ var saja = {
 			try{return new ActiveXObject("Microsoft.XMLHTTP");}catch(e){
 				try{return new ActiveXObject("Msxml2.XMLHTTP");}catch(e){}}
 	},
-	run: function(php, id, act, property, session_id, request_id, use_history){
+	run: function(php, id, act, property, session_id, request_id){
 		saja.procOn++;
 		var requestString = 'req=' + (SAJA_HTTP_KEY ? encodeURIComponent(saja.rc4(SAJA_HTTP_KEY, php)) : php) + '<!SAJA!>' + session_id + '<!SAJA!>' + (request_id || '');
 		requestString += '&rnd=' + Math.random();
-		if(use_history){
-			saja.addHistory(function(){
-				saja.procOn++;
-				saja.SendRequest(id, act, property, requestString);
-			});
-		}
 		saja.SendRequest(id, act, property, requestString);
 	},
 	SendRequest: function(id, act, property, requestString){
@@ -120,39 +117,5 @@ var saja = {
 			cipher += String.fromCharCode(data.charCodeAt(i) ^ k);
 		}
 		return cipher;
-	},
-	getForm: function(f){
-		var vals = {};
-		for(var i=0; i<f.length; i++)
-			if(f[i].id)
-				vals[f[i].id] = f[i].value;
-		return vals;
-	},
-	addHistory: function(value){
-		var historyURL1 = SAJA_PATH + 'saja.php/1/';
-		var historyURL2 = SAJA_PATH + 'saja.php/2/';
-		saja.historyValue = value;
-		saja.lastHistoryURL = saja.lastHistoryURL==historyURL2 ? historyURL1 : historyURL2;
-		saja.sajaHistory.location.href = saja.lastHistoryURL + '#' + (saja.historyIndex - 0 + 1);
-	},
-	monitorHistory: function(){
-		saja.lastHistoryURL = saja.sajaHistory.location.pathname;
-		var currentHash = saja.sajaHistory.location.hash;
-		var index = currentHash.split('#')[1];
-		if(saja.lastHash != currentHash){
-			if(saja.historyValue == null && index < saja.history.length)
-				saja.historyIndex = index;
-			else{
-				if(saja.historyIndex < saja.history.length-1)
-					saja.history.splice(saja.historyIndex-0+1, saja.history.length-saja.historyIndex-1);
-				saja.historyIndex = saja.history.length;
-				saja.history[saja.historyIndex] = saja.historyValue;
-			}
-			if(!currentHash && saja.history.length && saja.onBackToStart) saja.onBackToStart();
-			else if(saja.historyValue != saja.history[index]) saja.onHistoryChange(index);
-			saja.lastHash = currentHash;
-			saja.historyValue = null;
-		}
-		saja.historyInterval = window.setTimeout(saja.monitorHistory, 100);
-	}
+	}
 }
\ No newline at end of file
diff -rup saja-2.8/saja.php saja/saja.php
--- saja-2.8/saja.php	2007-07-16 22:24:00.000000000 +0200
+++ saja/saja.php	2007-07-23 00:16:12.000000000 +0200
@@ -45,7 +45,6 @@ class Saja {
 	var $actions = array();
 	var $salt;
 	var $http_key;
-	var $historyAvailable;
 	var $argument_separator = '>>>saja_arg<<';			//separator for function arguments
 	
 	function Saja()
@@ -100,28 +99,6 @@ class Saja {
 		return $js;
 	}
 	
-	function saja_history($initializer)
-	{
-		$this->historyAvailable = true;
-
-		return '
-		<iframe style="display:none;" id="sajaHistory" name="sajaHistory" src="'.$this->saja_path.'saja.php/1/"></iframe>
-		
-		<script type="text/javascript">
-		saja.onHistoryChange = function(i){
-			saja.history[i]();
-		}
-		
-		saja.historyIndex = -1;
-		saja.history = [];
-		saja.sajaHistory = window.frames["sajaHistory"];
-		saja.lastHash = saja.sajaHistory.location.hash;
-		saja.monitorHistory();
-		
-		'.$this->runWithHistory($initializer).'
-		</script>
-		';
-	}
 
 	function saja_status($style='', $string='Working...')
 	{
@@ -160,22 +137,17 @@ class Saja {
 		return $this->saja_process_path . $this->saja_process_file;
 	}
 
-	function runWithHistory($commands, $process_file=null)
-	{
-		return $this->run($commands, $process_file, 'true');
-	}
-
-	function run($commands, $process_file=null, $use_history='false')
+	function run($commands, $process_file=null)
 	{
 		if(!$this->http_key)
 			$this->clear_secure_http();
 		
 		if(!$process_file)
 			$process_file = $this->get_process_file();
-		return $this->ParseCommands($commands, $process_file, $use_history);
+		return $this->ParseCommands($commands, $process_file);
 	}
 
-	function ParseCommands($commands, $process_file, $use_history='false')
+	function ParseCommands($commands, $process_file)
 	{
 		$commands = $this->texplode(';', $commands);
 		$all_commands = '';
@@ -231,7 +203,7 @@ class Saja {
 					);
 					
 					$session_id = session_id();
-					$all_commands .= "saja.run('".$this->parseArgs($args, 'PHP')."','$targetId','$action','$targetProperty','$session_id','$request_id',$use_history);";
+					$all_commands .= "saja.run('".$this->parseArgs($args, 'PHP')."','$targetId','$action','$targetProperty','$session_id','$request_id');";
 				}
 			}
 		}
@@ -263,7 +235,7 @@ class Saja {
 				if($i) $inner .= $this->argument_separator;
 				if($property)
 					$inner .= "'+saja.Get('$id','$property')+'";
-				else if($arg)
+				else if($arg!=='')
 					$inner .= "'+saja.Get($arg)+'";
 				else
 					$inner .= "'+saja.Get($id)+'";
@@ -277,7 +249,7 @@ class Saja {
 	{
 		$vals = array();
 		foreach(explode($seperator, $str) as $val)
-			if($val)
+			if($val!=='')
 				$vals[] = trim($val);
 		return $vals;
 	}
@@ -305,12 +277,6 @@ class Saja {
 		$this->add_action("alert('".str_replace('\'', '\\\'', $txt)."')");
 	}
 		
-	//submit a form on the page
-	function submit($name)
-	{
-		$this->add_action("document.forms['$name'].submit()");
-	}
-
 	//adds a new saja action to the queue
 	function exec($action)
 	{
Only in saja: .svn
Only in saja: version.txt
